- protocol: mcintosh_v3
  name: "McIntosh v3 API"
  description: "Based on MX160 Serial Control Manual v3"

  # default baud rate (see series yaml for overrides per model)
  connection:
    rs232:
      baud: 115200
      data: 8
      parity: N
      stop: 1

  format:
    command:
      format: "{cmd}{eol}"
      eol: ""
      separator: '#'

    message:
      format: "{msg}{eol}"
      eol: "\r"
      separator: '#'

  api_settings:
    min_time_between_commands: 0.4

  api_vars:
    zone:
      pattern: '[1-8]'
      type: int
      min: 1
      max: 8
    power:
      pattern: '[01]'
      type: int
      min: 0
      max: 1
    mute:
      pattern: '[01]'
      type: int
      min: 0
      max: 1
    volume:
      type: int
      min: 0
      max: 38
    treble:
      type: int
      min: 0
      max: 14
    bass:
      type: int
      min: 0
      max: 14
    balance:
      type: int
      min: 0
      max: 63
    source:
      type: int
      min: 1
      max: 8

  api_v2:




# ------

    power:
      api:
        status:
          cmd: '?{zone}PR'
          msg: '\?(?P<zone>\d+)PR(?P<power>[01])\+'
        set:
          cmd: "!{zone}PR{power}"
        'on':
          cmd: '!{zone}PR1'
        'off':
          cmd: '!{zone}PR0'
        toggle:
          cmd: '!{zone}PT'
        all_zones_off:
          cmd: '!AO'

    mute:
      api:
        status:
          description: 'Mute status'
          cmd: '?{zone}MU'
          msg: '\?(?P<zone>\d+)MU(?P<mute>[01])\+'
        set:
          cmd: '!{zone}MU{mute}'
        'on':
          cmd: '!{zone}MU1'
        'off':
          cmd: '!{zone}MU0'
        toggle:
          description: 'Toggle Mute'
          cmd: '!{zone}MT'

    zone:
      api:
        status:
          cmd: '?{zone}ZD'
          msg: '#(?P<zone>\d+)ZS PR(?P<power>[01]) SS(?P<source>\d+) VO(?P<volume>\d+) MU(?P<mute>[01]) TR(?P<treble>\d+) BS(?P<bass>\d+) BA(?P<balance>\d+) LS(?P<linked>[01]) PS(?P<paged>[01])\+'
              # Example:  #1ZS PR0 SS1 VO0 MU1 TR7 BS7 BA32 LS0 PS0+
        details:
          cmd: '?{zone}ZD'
          msg: "FIXME"

    volume:
      api:
        status:
          cmd: '?{zone}VO'
          msg: '\?(?P<zone>\d+)VO(?P<volume>\d+)\+'
        set:
          cmd: '!{zone}VO{volume:02}'
        up:
          cmd: '!{zone}VI'
        down:
          cmd: '!{zone}VD'
    source:
      api:
        status:
          cmd: '?{zone}SS'
          msg: '\?(?P<zone>\d+)SS(?P<source>[1-8])\+'
        set:
          cmd: '!{zone}SS{source}'
        select:
          cmd: '!{zone}SS{source}'

    balance:
      api:
        status:
          cmd: '?{zone}BA'
          msg: '\?(?P<zone>\d+)BA(?P<balance>\d+)\+'
        balance:
          cmd: '!{zone}BA{balance:02}'
        left:
          cmd: '!{zone}BL'
        right:
          cmd: '!{zone}BR'

    bass:
      api:
        status:
          cmd: '?{zone}BS'
          msg: '\?(?P<zone>\d+)BS(?P<bass>\d+)\+'

        set:
          cmd: '!{zone}BS{bass:02}'
        up:
          cmd: '!{zone}BI'
          aliases:
            - '+'
        down:
          cmd: '!{zone}BD'
          aliases:
            - '-'

      treble:
        api:
          status:
            cmd: '?{zone}TR'
            msg: '\?(?P<zone>\d+)TR(?P<treble>\d+)\+'
          set:
            cmd: '!{zone}TR{treble:02}'
          up:
            cmd: '!{zone}TI'
          down:
            cmd: '!{zone}TD'

      activity_updates:
        api:
          'on':
            cmd: '!ZA1'
          'off':
            cmd: '!ZA0'
      status_updates:
        api:
          'on':
            cmd: '!ZP1'

          'off':
            cmd: '!ZP0'
